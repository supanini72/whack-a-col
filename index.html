<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Whack-a-Col'</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'BPReplay';
            src: url('BPreplay.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #13233b;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        /* --- ÉCRAN D'ACCUEIL --- */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #13233b;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .home-logo {
            width: 180px;
            height: auto;
            margin-bottom: 20px;
        }

        .home-title {
            font-family: 'BPReplay', sans-serif;
            font-size: 5rem;
            color: #ffffff;
            margin: 0;
            text-shadow: 6px 6px 0px rgba(0, 0, 0, 0.4);
        }

        .home-title span {
            color: #ed5e21; /* Le 'Col en orange */
        }

        .home-instruction {
            color: #ffffff;
            font-size: 1.5rem;
            margin: 30px 0;
            max-width: 600px;
            line-height: 1.4;
            font-weight: 400;
        }

        #play-button {
            background-color: #ed5e21;
            color: white;
            font-family: 'BPReplay', sans-serif;
            font-size: 2.5rem;
            padding: 20px 60px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 0 #b34316;
            transition: all 0.1s;
        }

        #play-button:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 #b34316;
        }

        /* --- INTERFACE DE JEU --- */
        #title {
            position: absolute;
            top: 25px;
            left: 30px;
            font-family: 'BPReplay', sans-serif;
            font-size: 3rem;
            color: #ffffff;
            z-index: 10;
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.4);
        }

        #top-right-logo {
            position: absolute;
            top: 25px;
            right: 30px;
            width: 130px;
            z-index: 10;
        }

        #score-container {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            z-index: 10;
        }

        .score-label { font-size: 2.2rem; display: block; }
        #score-value {
            color: #ed5e21;
            font-size: 5.5rem;
            display: block;
            margin-top: -5px;
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'BPReplay', sans-serif;
            font-size: 4rem;
            color: #ed5e21;
            display: none;
            text-align: center;
            background: rgba(19, 35, 59, 0.98);
            padding: 40px;
            border-radius: 40px;
            border: 6px solid #ed5e21;
            cursor: pointer;
            z-index: 100;
        }

        canvas { display: block; }
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translate(0,0); }
            20% { transform: translate(-8px, 0); }
            40% { transform: translate(8px, 0); }
            60% { transform: translate(-8px, 0); }
            80% { transform: translate(8px, 0); }
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <img src="ABE logo.png" class="home-logo" alt="Logo">
        <h1 class="home-title">Whack-a-<span>Col'</span></h1>
        <p class="home-instruction">Sur ce milieu TBX, comptez les colonies caractéristiques !</p>
        <button id="play-button" onclick="startGame()">Jouer</button>
    </div>

    <div id="title">Whack-a-Col'</div>
    <img src="ABE logo.png" id="top-right-logo" alt="Logo">
    
    <div id="score-container">
        <span class="score-label">Score</span>
        <span id="score-value">0</span>
    </div>

    <div id="game-over" onclick="resetGame()">
        GAME OVER<br>
        <span id="reason" style="font-size: 1.2rem; color: #ff9f43; display: block; margin-top: 10px; font-family: 'Roboto';"></span>
        <span style="font-size: 1.5rem; color: #ffffff; font-family: 'Roboto'; margin-top: 15px; display: block;">Cliquer pour rejouer</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreValue = document.getElementById('score-value');
        const gameOverElement = document.getElementById('game-over');
        const reasonElement = document.getElementById('reason');
        const startScreen = document.getElementById('start-screen');

        let score = 0;
        let gameActive = false;
        let colonies = [];
        let spawnRate = 800; 
        let lastSpawn = 0;
        let petriRadius = 0;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            petriRadius = Math.min(canvas.width, canvas.height) * 0.38;
        }

        window.addEventListener('resize', resize);
        resize();

        function startGame() {
            startScreen.style.display = 'none';
            gameActive = true;
            lastSpawn = performance.now();
            animate(performance.now());
        }

        class Colonie {
            constructor(isTrap = false) {
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * (petriRadius * 0.75);
                this.x = canvas.width / 2 + Math.cos(angle) * distance;
                this.y = canvas.height / 2 + Math.sin(angle) * distance;
                this.isTrap = isTrap;
                this.radius = 1; 
                this.growth = 0.87; 
                this.maxTrapSize = 10;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                if (this.isTrap) {
                    ctx.fillStyle = '#ffffff';
                    ctx.fill();
                    ctx.strokeStyle = '#e6e6e6';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                } else {
                    ctx.fillStyle = '#40E0D0';
                    ctx.fill();
                    ctx.strokeStyle = '#3bc4b7';
                    ctx.lineWidth = 2.5;
                    ctx.stroke();
                }
                ctx.closePath();
            }

            update() {
                if (!gameActive) return;
                if (!this.isTrap) {
                    this.radius += this.growth;
                } else if (this.radius < this.maxTrapSize) {
                    this.radius += this.growth;
                }

                const distToCenter = Math.sqrt(
                    Math.pow(this.x - canvas.width / 2, 2) + 
                    Math.pow(this.y - canvas.height / 2, 2)
                );

                if (!this.isTrap && distToCenter + this.radius >= petriRadius) {
                    endGame("Une colonie a débordé !");
                }
            }
        }

        function drawPetriDish() {
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            ctx.beginPath();
            ctx.arc(cx, cy, petriRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#fff9db';
            ctx.shadowBlur = 40;
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.beginPath();
            ctx.arc(cx, cy, petriRadius * 0.85, 0, Math.PI * 2);
            ctx.strokeStyle = '#f1e1a6';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(cx, cy, petriRadius, 0, Math.PI * 2);
            ctx.lineWidth = 14; 
            ctx.strokeStyle = '#e1e8ed';
            ctx.stroke();
        }

        function handleInput(e) {
            if (!gameActive) return;
            const rect = canvas.getBoundingClientRect();
            const clientX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const clientY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

            for (let i = colonies.length - 1; i >= 0; i--) {
                const c = colonies[i];
                const dist = Math.sqrt(Math.pow(clientX - c.x, 2) + Math.pow(clientY - c.y, 2));
                
                if (dist <= c.radius + 18) {
                    if (c.isTrap) {
                        endGame("Ici on ne compte que les colonies caractéristiques !");
                        return;
                    }
                    colonies.splice(i, 1);
                    score++;
                    scoreValue.innerText = score;
                    spawnRate = Math.max(180, spawnRate * 0.95);
                    return;
                }
            }
        }

        function endGame(reason) {
            if (!gameActive) return;
            gameActive = false;
            reasonElement.innerText = reason;
            canvas.classList.add('shake');
            setTimeout(() => { gameOverElement.style.display = 'block'; }, 200);
        }

        function resetGame() {
            score = 0; scoreValue.innerText = "0";
            colonies = []; gameActive = true; spawnRate = 800;
            canvas.classList.remove('shake');
            gameOverElement.style.display = 'none';
            lastSpawn = performance.now();
            requestAnimationFrame(animate);
        }

        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e); }, { passive: false });

        function animate(time) {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPetriDish();
            if (time - lastSpawn > spawnRate) {
                const isTrap = Math.random() < 0.25;
                colonies.push(new Colonie(isTrap));
                lastSpawn = time;
            }
            colonies.forEach(c => { c.update(); c.draw(); });
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>